---
title: 调试 T4 文本模板
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, troubleshooting
- text templates, debugging
author: jillre
ms.author: jillfra
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 5e5d1f36beecd1fca76f6c5d8c375d9542048ab8
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/19/2019
ms.locfileid: "72653924"
---
# <a name="debugging-a-t4-text-template"></a>调试 T4 文本模板
您可以在文本模板中设置断点。 若要调试设计时文本模板，请保存文本模板文件，然后在解决方案资源管理器中该文件的快捷菜单上选择 "**调试 T4 模板**"。 若要调试运行时文本模板，只需调试其所属的应用程序即可。

 若要调试文本模板，你应该了解模板转换过程的步骤。 不同类型的错误可能发生在每个步骤中。 步骤如下所示。

|步骤|设计时模板：发生时间|运行时模板：发生时间|
|-|-|-|
|代码是从文本模板生成的。<br /><br /> 指令中的错误或不匹配的或 disordered `<#...#>` 标记。|保存模板或调用文本转换时。|保存模板或调用文本转换时。|
|编译生成的代码。<br /><br /> 模板代码中的编译错误。|紧跟在上一步之后。|以及你的应用程序代码。|
|代码运行。<br /><br /> 模板代码中的运行时错误。|紧跟在上一步之后。|当应用程序运行并调用模板代码时。|

 在大多数情况下，错误报告中提供了模板代码中的行号。 当错误报告引用临时文件名时，通常的原因是文本模板的代码中的括号不匹配。

 您可以在文本模板中设置断点，并以常规方式进行调试。

## <a name="common-errors-and-fixes"></a>常见错误和修复
 下表列出了最常见的错误及其解决办法。

|错误消息|描述|解决方案|
|-|-|-|
|未能加载转换类所继承的基类 "{0}"。|如果在模板指令中找不到 `inherits` 参数中指定的基类，则会发生此错误。 消息提供模板指令的行号。|请确保指定的类存在，并且该程序集所在的程序集在程序集指令中指定。|
|未能解析文件的包含文本： {0}|当找不到包含的模板时发生。 消息提供所请求的包含文件的名称。|请确保文件路径是相对于原始模板路径的路径，或者该文件所在的位置已向主机注册，或者该文件有完整路径。|
|初始化转换对象时生成了错误。 转换将不会运行。|当转换类的 "Initialize （）" 失败或返回 false 时发生。|Initialize （）函数中的代码来自 \< # @template # > 指令中指定的基本转换类和指令处理器。 导致初始化失败的错误可能出现在 "错误列表" 中。 调查失败的原因。 可以通过遵循用于调试模板的过程来查看用于 Initialize （）的实际生成代码。|
|指令处理器 "{1}" 的程序集 "{0}" 未被授予 FullTrust 权限集。 只允许受信任的程序集提供指令处理器。 将不加载此指令处理器。|当系统未向包含指令处理器的程序集授予 FullTrust 权限时发生。 消息提供程序集的名称和指令处理器的名称。|请确保只使用本地计算机上受信任的程序集。|
|路径 "{0}" 必须是此计算机或部分受信任区域的本地路径。|当指令或程序集指令引用不在本地计算机上或网络的受信任区域中的文件时发生。|请确保指令或程序集指令所在的目录位于受信任的区域中。 可以通过 Internet Explorer 将网络目录添加到受信任的区域。|
|多个语法错误，如 "无效的标记" catch "" 或 "命名空间不能直接包含成员"|模板代码中右大括号太多。 编译器会将其与标准生成代码混淆。|检查代码分隔符内的右大括号和方括号的数目。|
|循环或条件未正确编译或执行。 例如：`<#if (i>10)#> Number is: <#= i #>`。<br /><br /> 此代码始终输出 i 的值。 只有 "Number is：" 是有条件的。|在C#中，始终使用大括号来包围嵌入到控件语句中的文本块。|添加大括号： `<#if (i>10) { #>    Number is: <#= i #><# } #>`。|
|处理设计时模板或编译运行时（预处理）模板时，"表达式太复杂"。<br /><br /> 尝试检查运行时模板生成的代码时，Visual Studio 将停止工作。|文本块太长。 T4 将文本块转换为字符串连接表达式，并为每个模板行使用一个字符串文本。 非常长的文本块可以 overstep 编译器的大小限制。|使用表达式块（例如）分解长文本块：<br /><br /> `<#= "" #>`|

## <a name="warning-descriptions-and-fixes"></a>警告说明和修复
 下表列出了最常见的警告以及修补程序（如果有）。

|警告消息|描述|解决方案|
|-|-|-|
|加载包含文件 "{0}" 返回了 null 或空字符串。|当包含的文本模板文件为空时发生。 消息提供包含的文件的文件名。|请删除 include 指令，或确保该文件包含某些内容。|
|编译转换：|在编译转换时，将此字符串预置到源自编译器的所有错误或警告。 此字符串表示编译器引发错误或警告。|如果在查找 DLL 时遇到问题，可能需要提供完整路径或完全限定强名称（如果该 DLL 在 GAC 中）。|
|指令中已存在参数 "{0}"。 将忽略重复的参数。|在指令中多次指定参数时发生。 消息提供参数的名称和指令的行号。|请删除重复的参数规范。|
|加载包含文件 "{0}" 时出错。 将忽略 include 指令。|当找不到 `include` 指令中指定的文件时发生。 消息提供文件的名称和指令的行号。|请确保包含文件存在于原始文本模板文件所在的目录中或已注册到主机的其中一个包含目录中。|
|为转换类指定的基类无效。 基类必须派生自 VisualStudio. TextTemplating. TextTransformation。|当模板指令中的 `inherits` 参数指定的类不是从 `TextTransformation` 继承时出现。 消息提供模板指令的行号。|指定从 `TextTransformation` 派生的类。|
|在 "template" 指令中指定的区域性无效。 区域性的格式必须为 "xx-XX"。 将使用固定区域性。|如果未正确指定模板指令中的区域性参数，则发生此事件。 消息提供模板指令的行号。|将 culture 参数更改为 "xx-XX" 格式的有效区域。|
|在 template 指令中指定了无效的调试值 "{0}"。 调试值必须是 "true" 或 "false"。 将使用默认值 "false"。|当错误地指定了模板指令中的 `debug` 参数时发生。 消息提供模板指令的行号。|将 debug 参数设置为 "true" 或 "false"。|
|在 template 指令中指定了无效的 HostSpecific 值 "{0}"。 HostSpecific 值必须是 "true" 或 "false"。 将使用默认值 "false"。|如果未正确指定 `template` 指令中特定于宿主的参数时发生。 消息提供模板指令的行号。|将特定于主机的参数设置为 "true" 或 "false"。|
|在 "template" 指令中指定了无效的语言 "{0}"。 语言必须是 "C#" 或 "VB"。 将使用 "C#" 的默认值。|在 `template` 指令中指定了不受支持的语言时发生。 只允许C#使用 "" 或 "VB" （不区分大小写）。 消息提供模板指令的行号。|将模板指令中的 `language` 参数设置为 "C#" 或 "VB"。|
|在模板中找到多个输出指令。 除第一个以外的所有项都将被忽略。|在模板文件中指定多个 `output` 指令时发生。 消息提供重复的 output 指令的行号。|删除重复的 `output` 指令。|
|在模板中找到多个模板指令。 除第一个以外的所有项都将被忽略。 应在一个模板指令中指定模板指令的多个参数。|如果在文本模板文件（包括包含的文件）中指定多个 `template` 指令，则会发生此错误。 消息提供重复模板指令的行号。|将不同 `template` 指令聚合为一个 `template` 指令。|
|未为名为 "{0}" 的指令指定任何处理器。 指令将被忽略。|如果指定 `custom` 指令，但不提供 `processor` 属性，则会发生此错误。 消息提供指令的名称和行号。|提供一个 `processor` 属性，其中包含指令的 `directive` 处理器的名称。|
|对于名为 "{1}" 的指令，找不到名为 "{0}" 的处理器。 指令将被忽略。|系统找不到在 `custom` 指令中指定的 `directive` 处理器时发生。 消息提供指令名称、处理器名称和指令的行号。|将指令中的 `processor` 属性设置为指令处理器的名称。|
|找不到指令 "{1}" 的必需参数 "{0}"。 指令将被忽略。|系统未提供所需的指令参数时发生。 消息提供缺少的参数的名称、指令名称和行号。|提供缺少的参数。|
|名为 "{0}" 的处理器不支持名为 "{1}" 的指令。 指令将被忽略。|指令处理器不支持指令时发生。 消息提供了有问题的指令的名称和行号以及指令处理器的名称。|更正指令的名称。|
|文件 "{0}" 的 include 指令导致无限循环。|如果指定了环形 include 指令（例如，文件 A 包含文件 B，其中包含文件 A），则显示此内容。|不要指定循环包含指令。|
|正在运行转换：|在运行转换时生成的所有错误或警告前面预置此字符串。|不适用。|
|在块中发现意外的开始或结束标记。 请确保未错误键入开始或结束标记，并且模板中没有任何嵌套块。|出现意外的 \< # 或 # > 时显示。 也就是说，如果在另一个未关闭的打开标记后面有 \< #，或者当它之前没有未闭合的打开标记时有 # >。 消息提供不匹配标记的行号。|删除不匹配的开始或结束标记，或使用转义符。|
|指定了指令的格式不正确。 指令将被忽略。 请以格式指定指令 `<#@ name [parametername="parametervalue"]*  #>`|如果未以正确的格式指定指令，则由分析器显示。 消息提供不正确的指令的行号。|请确保所有指令的形式均为 `<#@ name [parametername="parametervalue"]*  #>`。 有关详细信息，请参阅[T4 文本模板指令](../modeling/t4-text-template-directives.md)。|
|未能为注册的指令处理器 "{1}" 加载程序集 "{0}"<br /><br /> {2}|当主机无法加载指令处理器时发生。 此消息标识为指令处理器提供的程序集和指令处理器的名称。|请确保指令处理器已正确注册并且该程序集存在。|
|找不到注册的指令处理器 "{2}" 的程序集 "{1}" 中的类型 "{0}"<br /><br /> {3}|当无法从程序集加载指令处理器类型时发生。 消息提供类型、程序集和指令处理器的名称。|Vshost.exe 在注册表中查找指令处理器信息（名称、程序集和类型）。 请确保指令处理器已正确注册，并且该类型存在于程序集中。|
|加载程序集 "{0}" 时出现问题|在加载程序集时出现问题时发生。 消息提供程序集的名称。|可以指定要在 \< @ #assembly # > 指令和指令处理器加载的程序集。 此字符串后面的错误消息应提供有关程序集加载失败的原因的更多数据。|
|为名为 "{1}" 的指令创建和初始化处理器时出现问题。 处理器的类型为 {0}。 指令将被忽略。|当系统无法创建或初始化指令处理器时发生。 消息提供指令的名称和行号，以及处理器的类型。|请确保使用正确的指令处理器，并且指令处理器具有公共的默认构造函数。 否则，请使用调试选项来找出指令处理器的 Initialize （）方法失败的原因。 有关详细信息，请参阅[疑难解答文本模板](../modeling/debugging-a-t4-text-template.md)。|
|处理名为 "{0}" 的指令时引发了异常。|当指令处理器在处理指令时引发异常时发生。|请确保指令处理器的参数正确。|
|尝试解析程序集引用 "{0}" 时，主机引发了异常。|当宿主尝试解析程序集引用时引发异常时发生。 消息提供程序集引用字符串。|程序集引用来自 \< @ #assembly # > 指令和指令处理器。 请确保 assembly 参数中提供的 "name" 参数正确。|
|尝试为指令指定不受支持的 {1} 值 "{0}" {2}|当你提供不受支持的需要或提供参数时，RequiresProvidesDirectiveProcessor （我们生成的所有指令处理器均派生自）发生。|请确保 "需要" 和 "提供参数" 中提供的名称为 "value" 对的名称正确无误。|